- name: Home
  # Optionally, if you only have a single page you can hide the desktop navigation for a cleaner look
  hide-desktop-navigation: true
  columns:
    - size: small
      widgets:
        
        #SERVER_STATS
        - type: server-stats
          servers:
            - type: local
              name: Ubuntu

        #SPEEDTEST_TRACKER
        - type: custom-api
          cache: 1h
          title: Internet Speed
          title-url: ${SPEEDTEST_URL}
          url: ${SPEEDTEST_URL}/api/v1/results/latest
          headers:
            Authorization: Bearer ${SPEEDTEST_TRACKER_API_TOKEN}
            Accept: application/json
          subrequests:
            stats:
              url: ${SPEEDTEST_URL}/api/v1/stats
              headers:
                Authorization: Bearer ${SPEEDTEST_TRACKER_API_TOKEN}
                Accept: application/json
          options:
            showPercentageDiff: true
          template: |
            {{ $showPercentage := .Options.BoolOr "showPercentageDiff" true }}

            {{ $stats := .Subrequest "stats" }}
            <div class="flex justify-between text-center margin-block-3">
            <div>
                {{ $downloadChange := percentChange ($stats.JSON.Float "data.download.avg_bits") (.JSON.Float "data.download_bits")
                }}
                {{ if $showPercentage }}
                <div
                class="size-small {{ if gt $downloadChange 0.0 }}color-positive{{ else if lt $downloadChange 0.0 }}color-negative{{ else }}color-primary{{ end }}"
                style="display: inline-flex; align-items: center;">
                {{ $downloadChange | printf "%+.1f%%" }}
                {{ if gt $downloadChange 0.0 }}
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor"
                    style="height: 1em; margin-left: 0.25em;" class="size-4">
                    <path fill-rule="evenodd"
                    d="M9.808 4.057a.75.75 0 0 1 .92-.527l3.116.849a.75.75 0 0 1 .528.915l-.823 3.121a.75.75 0 0 1-1.45-.382l.337-1.281a23.484 23.484 0 0 0-3.609 3.056.75.75 0 0 1-1.07.01L6 8.06l-3.72 3.72a.75.75 0 1 1-1.06-1.061l4.25-4.25a.75.75 0 0 1 1.06 0l1.756 1.755a25.015 25.015 0 0 1 3.508-2.85l-1.46-.398a.75.75 0 0 1-.526-.92Z"
                    clip-rule="evenodd" />
                </svg>
                {{ else if lt $downloadChange 0.0 }}
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor"
                    style="height: 1em; margin-left: 0.25em;" class="size-4">
                    <path fill-rule="evenodd"
                    d="M1.22 4.22a.75.75 0 0 1 1.06 0L6 7.94l2.761-2.762a.75.75 0 0 1 1.158.12 24.9 24.9 0 0 1 2.718 5.556l.729-1.261a.75.75 0 0 1 1.299.75l-1.591 2.755a.75.75 0 0 1-1.025.275l-2.756-1.591a.75.75 0 1 1 .75-1.3l1.097.634a23.417 23.417 0 0 0-1.984-4.211L6.53 9.53a.75.75 0 0 1-1.06 0L1.22 5.28a.75.75 0 0 1 0-1.06Z"
                    clip-rule="evenodd" />
                </svg>
                {{ end }}
                </div>
                {{ end }}
                <div class="color-highlight size-h3">{{ .JSON.Float "data.download_bits" | mul 0.000001 | printf "%.1f" }}</div>
                <div class="size-h6">DOWNLOAD</div>
            </div>
            <div>
                {{ $uploadChange := percentChange ($stats.JSON.Float "data.upload.avg_bits") (.JSON.Float "data.upload_bits") }}
                {{ if $showPercentage }}
                <div
                class="size-small {{ if gt $uploadChange 0.0 }}color-positive{{ else if lt $uploadChange 0.0 }}color-negative{{ else }}color-primary{{ end }}"
                style="display: inline-flex; align-items: center;">
                {{ $uploadChange | printf "%+.1f%%" }}
                {{ if gt $uploadChange 0.0 }}
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor"
                    style="height: 1em; margin-left: 0.25em;" class="size-4">
                    <path fill-rule="evenodd"
                    d="M9.808 4.057a.75.75 0 0 1 .92-.527l3.116.849a.75.75 0 0 1 .528.915l-.823 3.121a.75.75 0 0 1-1.45-.382l.337-1.281a23.484 23.484 0 0 0-3.609 3.056.75.75 0 0 1-1.07.01L6 8.06l-3.72 3.72a.75.75 0 1 1-1.06-1.061l4.25-4.25a.75.75 0 0 1 1.06 0l1.756 1.755a25.015 25.015 0 0 1 3.508-2.85l-1.46-.398a.75.75 0 0 1-.526-.92Z"
                    clip-rule="evenodd" />
                </svg>
                {{ else if lt $uploadChange 0.0 }}
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor"
                    style="height: 1em; margin-left: 0.25em;" class="size-4">
                    <path fill-rule="evenodd"
                    d="M1.22 4.22a.75.75 0 0 1 1.06 0L6 7.94l2.761-2.762a.75.75 0 0 1 1.158.12 24.9 24.9 0 0 1 2.718 5.556l.729-1.261a.75.75 0 0 1 1.299.75l-1.591 2.755a.75.75 0 0 1-1.025.275l-2.756-1.591a.75.75 0 1 1 .75-1.3l1.097.634a23.417 23.417 0 0 0-1.984-4.211L6.53 9.53a.75.75 0 0 1-1.06 0L1.22 5.28a.75.75 0 0 1 0-1.06Z"
                    clip-rule="evenodd" />
                </svg>
                {{ end }}
                </div>
                {{ end }}
                <div class="color-highlight size-h3">{{ .JSON.Float "data.upload_bits" | mul 0.000001 | printf "%.1f" }}</div>
                <div class="size-h6">UPLOAD</div>
            </div>
            <div>
                {{ $pingChange := percentChange ($stats.JSON.Float "data.ping.avg") (.JSON.Float "data.ping") }}
                {{ if $showPercentage }}
                <div
                class="size-small {{ if gt $pingChange 0.0 }}color-negative{{ else if lt $pingChange 0.0 }}color-positive{{ else }}color-primary{{ end }}"
                style="display: inline-flex; align-items: center;">
                {{ $pingChange | printf "%+.1f%%" }}
                {{ if lt $pingChange 0.0 }}
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor"
                    style="height: 1em; margin-left: 0.25em;" class="size-4">
                    <path fill-rule="evenodd"
                    d="M1.22 4.22a.75.75 0 0 1 1.06 0L6 7.94l2.761-2.762a.75.75 0 0 1 1.158.12 24.9 24.9 0 0 1 2.718 5.556l.729-1.261a.75.75 0 0 1 1.299.75l-1.591 2.755a.75.75 0 0 1-1.025.275l-2.756-1.591a.75.75 0 1 1 .75-1.3l1.097.634a23.417 23.417 0 0 0-1.984-4.211L6.53 9.53a.75.75 0 0 1-1.06 0L1.22 5.28a.75.75 0 0 1 0-1.06Z"
                    clip-rule="evenodd" />
                </svg>
                {{ else if gt $pingChange 0.0 }}
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor"
                    style="height: 1em; margin-left: 0.25em;" class="size-4">
                    <path fill-rule="evenodd"
                    d="M9.808 4.057a.75.75 0 0 1 .92-.527l3.116.849a.75.75 0 0 1 .528.915l-.823 3.121a.75.75 0 0 1-1.45-.382l.337-1.281a23.484 23.484 0 0 0-3.609 3.056.75.75 0 0 1-1.07.01L6 8.06l-3.72 3.72a.75.75 0 1 1-1.06-1.061l4.25-4.25a.75.75 0 0 1 1.06 0l1.756 1.755a25.015 25.015 0 0 1 3.508-2.85l-1.46-.398a.75.75 0 0 1-.526-.92Z"
                    clip-rule="evenodd" />
                </svg>
                {{ end }}
                </div>
                {{ end }}
                <div class="color-highlight size-h3">{{ .JSON.Float "data.ping" | printf "%.0f ms" }}</div>
                <div class="size-h6">PING</div>
            </div>
            </div>

        #ADGUARD_STATS
        - type: dns-stats
          service: adguard
          url: https://adguard.domain.com/
          username: admin
          password: ${ADGUARD_PASSWORD}

        #JELLYFIN_STATS
        - type: custom-api
          title: "Jellyfin/Emby Stats"
          base-url: ${JELLYFIN_URL}
          options:
            url: ${JELLYFIN_URL}
            key: ${JELLYFIN_API_KEY}
          template: |
            {{ $url := .Options.StringOr "url" "" }}
            {{ $key := .Options.StringOr "key" "" }}

            {{- if or (eq $url "") (eq $key "") -}}
            
              <p>Error: The URL or API Key was not configured in the widget options.</p>
              
            {{- else -}}

              {{- $requestUrl := printf "%s/emby/Items/Counts?api_key=%s" $url $key -}}
              {{- $jellyfinData := newRequest $requestUrl | getResponse -}}

              {{- if eq $jellyfinData.Response.StatusCode 200 -}}
                <div class="flex flex-column gap-5">
                  <div class="flex justify-between text-center">
                    
                    <div>
                      <div class="color-highlight size-h3">{{ $jellyfinData.JSON.Int "MovieCount" | formatNumber }}</div>
                      <div class="size-h5 uppercase">Movies</div>
                    </div>

                    <div>
                      <div class="color-highlight size-h3">{{ $jellyfinData.JSON.Int "SeriesCount" | formatNumber }}</div>
                      <div class="size-h5 uppercase">TV Shows</div>
                    </div>

                    <div>
                      <div class="color-highlight size-h3">{{ $jellyfinData.JSON.Int "EpisodeCount" | formatNumber }}</div>
                      <div class="size-h5 uppercase">Episodes</div>
                    </div>

                    <div>
                      <div class="color-highlight size-h3">{{ $jellyfinData.JSON.Int "SongCount" | formatNumber }}</div>
                      <div class="size-h5 uppercase">Songs</div>
                    </div>

                  </div>
                </div>
              {{- else -}}
                <p>Failed: {{ $jellyfinData.Response.Status }}</p>
              {{- end -}}
            {{- end -}}
        
        #IMMICH_STATS
        - type: custom-api
          title: Immich stats
          cache: 1d
          url: https://${IMMICH_URL}/api/server/statistics
          headers:
            x-api-key: ${IMMICH_API_KEY}
            Accept: application/json
          template: |
            <div class="flex justify-between text-center">
              <div>
                  <div class="color-highlight size-h3">{{ .JSON.Int "photos" | formatNumber }}</div>
                  <div class="size-h6">PHOTOS</div>
              </div>
              <div>
                  <div class="color-highlight size-h3">{{ .JSON.Int "videos" | formatNumber }}</div>
                  <div class="size-h6">VIDEOS</div>
              </div>
              <div>
                  <div class="color-highlight size-h3">{{ div (.JSON.Int "usage" | toFloat) 1073741824 | toInt | formatNumber }}GB</div>
                  <div class="size-h6">USAGE</div>
              </div>
            </div>

    - size: full
      widgets:

        #CONTAINERS_LISTS
        - type: monitor
          cache: 5m
          title: containers
          sites:
            - title: CasaOS
              url: http://192.168.86.XXX/#/
              icon: https://wiki.casaos.io/_assets/casaos-no-text.svg
            - title: Home Assistant
              url: http://192.168.86.XXX:8123/lovelace/home
              icon: https://upload.wikimedia.org/wikipedia/en/thumb/4/49/Home_Assistant_logo_%282023%29.svg/1200px-Home_Assistant_logo_%282023%29.svg.png
            - title: Plex
              url: http://192.168.86.XXX:32400/web/index.html#!/
              icon: https://upload.wikimedia.org/wikipedia/commons/8/8e/Plex_favicon.png
            - title: OpensSeedTest
              url: http://192.168.86.XXX:3004/
              icon: https://cdn.jsdelivr.net/gh/IceWhaleTech/CasaOS-AppStore@main/Apps/OpenSpeedTest/icon.png
            - title: Jellyfin
              url: http://192.168.86.XXX:8096/web/#/home
              icon: https://icon.casaos.io/main/all/jellyfin.png
            - title: Immich
              url: http://192.168.86.XXX:2283/photos
              icon: https://play-lh.googleusercontent.com/nJsRIdtaot1-FKH3kiRem4kjqUU1-_0hd_64qZH0BgtzUecYfWLCDfpk2nNVul8hOrw
            - title: AdGuard
              url: http://192.168.86.XXX:8123/a0d7b954_adguard/ingress
              icon: https://avatars3.githubusercontent.com/u/8361145?s=200&v=4
            - title: dockpeek
              url: http://192.168.86.XXX:3420/
              icon: https://cdn.jsdelivr.net/gh/selfhst/icons/png/dockpeek.png
            - title: n8n
              url: http://192.168.86.XXX:5678/
              icon: https://cdn.jsdelivr.net/gh/selfhst/icons/png/n8n.png
            - title: NetAlertX
              url: http://192.168.86.XXX:8080/devices.php
              icon: https://avatars.githubusercontent.com/u/96159884?s=48&v=4
            - title: Speedtest Tracker
              url: http://192.168.86.XXX:8282/admin
              icon: https://cdn.jsdelivr.net/gh/alexjustesen/speedtest-tracker/public/img/speedtest-tracker-icon.png
            - title: Wallabag
              url: http://192.168.86.XXX:8484/
              icon: https://avatars.githubusercontent.com/u/4143872?s=280&v=4
            - title: ConvertX
              url: http://192.168.86.XXX:3000/
              icon: https://cdn.jsdelivr.net/gh/selfhst/icons/webp/convertx.webp
            - title: termix
              url: http://192.168.86.XXX:8585/
              icon: https://avatars.githubusercontent.com/u/236961563?s=48&v=4
            - title: Uptime Kuma
              url: http://192.168.86.XXX:3001/dashboard
              icon: https://cdn.jsdelivr.net/gh/selfhst/icons/png/uptime-kuma.png
            - title: Dozzle
              url: http://192.168.86.XXX:8888/
              icon: https://dozzle.dev/logo.svg
            - title: FreshRSS
              url: http://192.168.86.XXX:8749/
              icon: https://cdn.jsdelivr.net/gh/IceWhaleTech/CasaOS-AppStore@main/Apps/FreshRSS/icon.png
            - title: Nextcloud
              url: http://192.168.86.XXX:7580/
              icon: https://cdn.jsdelivr.net/gh/selfhst/icons/png/nextcloud.png
            - title: Calibre-web
              url: http://192.168.86.XXX:8083/
              icon: https://cdn.jsdelivr.net/gh/IceWhaleTech/CasaOS-AppStore@main/Apps/Calibre-web/icon.png
            - title: Tautulli
              url: http://192.168.86.XXX:8181/home
              icon: https://tautulli.com/images/logo-circle.png
            - title: Trilium
              url: http://192.168.86.XXX:9002/
              icon: https://cdn.jsdelivr.net/gh/selfhst/icons/png/trilium-notes.png
            - title: Yamtrack
              url: http://192.168.86.XXX:4003/
              icon: https://getumbrel.github.io/umbrel-apps-gallery/yamtrack/icon.svg
            - title: Syncthing
              url: http://192.168.86.XXX:8384/
              icon: https://play-lh.googleusercontent.com/IpWDCTwJMZHAxba8G8zOAUy9p3Jrw8iaBLx19PbEvyWP__d_RGxwWknKg-jzI_6HN2Ob
            - title: Linkwarden
              url: http://192.168.86.XXX:3089/dashboard
              icon: https://docs.linkwarden.app/img/logo.png

        - type: group
          widgets:
            #REDDIT_POSTS
            - type: reddit
              subreddit: selfhosted
              show-thumbnails: true
            - type: reddit
              subreddit: homelab
              show-thumbnails: true
            - type: reddit
              subreddit: pico8
              show-thumbnails: true

    - size: small
      widgets:
      
        #CLOCK
        - type: clock
          hour-format: 12h

        #WEATHER
        - type: weather
          #title: " "
          location: Dhaka, Bangladesh
          units: metric # alternatively "imperial"
          hour-format: 12h # alternatively "24h"
          # Optionally hide the location from being displayed in the widget
          # hide-location: true

        #TO_DO_LIST
        - type: to-do

        #APP_UPDATES
        - type: releases
          cache: 1d
          # Without authentication the Github API allows for up to 60 requests per hour. You can create a
          # read-only token from your Github account settings and use it here to increase the limit.
          #token: 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
          repositories:
            - immich-app/immich
            - n8n-io/n8n

        #RANDOM_FACTS
        - type: custom-api
          title: Random Fact
          cache: 6h
          url: https://uselessfacts.jsph.pl/api/v2/facts/random
          template: |
            <p class="size-h4 color-paragraph">{{ .JSON.String "text" }}</p>

        